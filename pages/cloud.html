
<!DOCTYPE html>
<!--[if IE 7 ]>		 <html class="no-js ie ie7 lte7 lte8 lte9" lang="en-US"> <![endif]-->
<!--[if IE 8 ]>		 <html class="no-js ie ie8 lte8 lte9" lang="en-US"> <![endif]-->
<!--[if IE 9 ]>		 <html class="no-js ie ie9 lte9>" lang="en-US"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->
<html lang="en-US">
<!--<![endif]-->
<!-- 

 -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="description" content="地理空间数据云" />

    <!-- qq登录 -->
    <meta property="qc:admins" content="2041466166673347546367" />

    <!-- 微博登录 -->
    <meta property="wb:webmaster" content="366d0e2cc005fe6c"/>

    <title>地理空间数据云</title>

    <script type="text/javascript" src="/static/js/jquery.min.js"></script>

    <link href="/static/bootstrap/css/bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap.min.js"></script>

    <link href="/static/plugin/noty/jquery.noty.css" rel="stylesheet">
    <script type="text/javascript" src="/static/plugin/noty/jquery.noty.min.js"></script>

    <link rel="stylesheet" href="/static/css/jqueryui.min.css" />
    <script type="text/javascript" src="/static/js/jqueryui.min.js"></script>

    <script type="text/javascript" src="/static/js/browserdetecter.js"></script>

    <!--

     -->


    <link rel="stylesheet" href="/static/plugin/colorbox/colorbox.css" />
    <script type="text/javascript" src="/static/plugin/colorbox/jquery.colorbox-min.js"></script>

    <script src="/static/js/jquery.form.min.js"></script>
    <script src="/static/plugin/jquery-validation/dist/jquery.validate.js"></script>



    <link href="/static/css/common.css" rel="stylesheet">


    <style>
        .item_bg {
            height: 40px;
            width: 192px;
            text-align: center;
            line-height: 40px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 20px;
            font-size: 19px;
        }

        .div_lap {
            margin: 15px auto;
        }

        input:focus {
            outline: none;
        }

        input:-webkit-autofill {
            -webkit-box-shadow: 0 0 0px 1000px white inset;
        }

        .login_body {
            margin-top: 80px;
            height: 400px;
        }

        .other_accounts {
            display: inline-block;
            width: 400px;
            height: 260px;
            padding-left: 110px;
            font-size: 18px;
            border-right: 1px solid rgb(180, 180, 180);
            vertical-align: top;
            text-align: left;
            padding-top: 30px;
        }

        .other_screen_login {
            display: none;
        }

        @media ( max-width : 992px) {
            .other_accounts {
                display: none
            }
            .sign_in_page {
                padding: 0;
                height: 200px;
            }
            .other_screen_login {
                display: block;
                width: 400px;
                text-align: left;
                margin: auto;
            }
        }

        .footer-fixed {
            display: none;
        }

        .footer-body {
            bottom: 0px;
            position: absolute;
            width: 100%;
        }

        #sign-up-btn, #sign-in-btn{
            font-size: 16px;
        }

        #sign-up-btn{
            border-right: 1px solid red;
            padding-right: 5px;
        }

    </style>


    <style>
        .sign-in-page,.sign-up-page {
            width: 400px;
            height: 260px;
            padding-left: 45px;
            font-size: 18px;
            vertical-align: top;
            padding-top: 30px;
            display: none;
        }

        .sign-up-page .help-block{
            font-size: 14px;
            text-align: left;
        }
    </style>






</head>
<body>

<style>
    .cart_txt {
        position: absolute;
        border-radius: 11px;
        font-size: 10px;
        padding: 2px;
        background-color: rgba(255, 255, 0, 0.8);
        width: 22px;
        height: 22px;
        top: 0px;
        padding-top: 3px;
        text-align: center;
    }

    .cart_txt a {
        color: red;
    }

    .cart_txt a:hover {
        text-decoration: none;
    }
</style>
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid fixed_body">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/"> <img src="/static/img/navi/logo_01.png">
            </a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <!-- <li ><a href="/">平台首页</a></li> -->
                <li ><a href="/search">高级检索</a></li>
                <li ><a href="/sources">数据资源</a></li>
                <li ><a href="/crowdsourcing/tasks/">数据众包</a></li>

                <li ><a href="/wps">在线计算</a></li>

                <li ><a href="/help/">平台信息</a></li>

                <!-- <li><a href="http://www.giscloud.cn/" target="_blank">旧版网站</a></li> -->

            </ul>

        </div>
    </div>
</div>



<div class="login_body">

    <div style="margin: 20px auto; text-align: center; height: 16px;">
        <span style="font-size: 16px; color: red; display: none" id="error_msg"></span>
    </div>

    <div style="margin: 20px auto; text-align: center">
        <div class="other_accounts">
            <p class="btn-danger item_bg" onclick="javascript:esc_login()">科技网用户登录</p>
            <p class="item_bg" onclick="javascript:qq_login()"><img src="/static/img/accounts/qq_login_logo.png" height="40px"></p>
            <!-- <p class="bg-success item_bg" onclick="javascript:qq_login()">QQ用户登录</p> -->
            <!-- <p class="bg-info item_bg" onclick="javascript:wb_login()">微博用户登录</p> -->

            <span id="sign-up-btn">没有帐号？<a href="javascript:void(0 )">注册</a></span>
            <span id="sign-in-btn">已有帐号？<a href="javascript:void(0 )">登录</a></span>

        </div>


        <div class="sign-in-page" style="display: inline-block;">

            <form id="login-form" class="form-horizontal" role="form" method="post">
                <input type='hidden' name='csrfmiddlewaretoken' value='23mw5HtHge4Itkum4odNsgPTvhNUUYjD' />

                <input type="hidden" value="" name="next">

                <div class="form-group">
                    <label class="col-sm-3 control-label" for="userid">邮箱：</label>
                    <div class="col-sm-8" style="padding-left: 0px;padding-right: 0px;">
                        <input placeholder="邮箱" class="form-control left" id="userid" name="userid">
                    </div>
                    <div class="errormsgwrapper col-sm-1">
                        <!-- <span class="validation-icon hidden" aria-hidden="true"></span> -->
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label" for="password">密码：</label>
                    <div class="col-sm-8" style="padding-left: 0px;padding-right: 0px;">
                        <input type="password" placeholder="密码" class="form-control left" id="password" name="password">
                    </div>
                    <div class="errormsgwrapper col-sm-1">
                        <!-- <span class="validation-icon hidden" aria-hidden="true"></span> -->
                    </div>
                </div>

                <div class="form-group" style="font-size: 16px;">
                    <div class="checkbox pull-left" style="padding-left: 95px;padding-top: 0px;">
                        <label>
                            <input type="checkbox" name="remember_me" value="1"> 自动登录
                        </label>
                    </div>
                    <span class="pull-right" style="margin-right: 30px;">忘记密码？
				<a href="/accounts/reset_password" style="color: #37A6E9; cursor: pointer">重置</a>
			</span>
                </div>
                <input type="submit" value="登录" class="btn btn-success btn-enroll">
            </form>
        </div>

        <div class="sign-up-page container-fluid" >

            <form id="register-form" class="form-horizontal" role="form" method="post">
                <input type='hidden' name='csrfmiddlewaretoken' value='23mw5HtHge4Itkum4odNsgPTvhNUUYjD' />
                <div class="form-group">
                    <label class="col-sm-3 control-label" for="reg_username">昵称：</label>
                    <div class="col-sm-8" style="padding-left: 0px;padding-right: 0px;">
                        <input placeholder="用户名" class="form-control left" id="reg_username" name="reg_username">
                    </div>
                    <div class="errormsgwrapper col-sm-1">
                        <span class="validation-icon hidden" aria-hidden="true"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label" for="reg_email">邮箱：</label>
                    <div class="col-sm-8" style="padding-left: 0px;padding-right: 0px;">
                        <input placeholder="邮箱" class="form-control left" id="reg_email" name="reg_email">
                    </div>
                    <div class="errormsgwrapper col-sm-1">
                        <span class="validation-icon hidden" aria-hidden="true"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label" for="reg_password">密码：</label>
                    <div class="col-sm-8" style="padding-left: 0px;padding-right: 0px;">
                        <input type="password" placeholder="密码" class="form-control left" id="reg_password" name="reg_password">
                    </div>
                    <div class="errormsgwrapper col-sm-1">
                        <span class="validation-icon hidden" aria-hidden="true"></span>
                    </div>
                </div>
                <input type="submit" value="注册" class="btn btn-success btn-enroll">
            </form>
        </div>


    </div>

</div>




<script>

    var notice_id = null;
    var notice = function(){
        $("#unread-news-icon").toggle();
        notice_id = setTimeout("notice()",500)
    };

    $(function(){

        $("#qrcode-btn").popover({
            html: true,
            container: "#qrcode-btn",
            title: "欢迎关注",
            content: "<img src='/static/img/index/qrcode.jpg' width=120px>",
            placement: "left",
            trigger: "focus"
        });

        $("#advice-btn").popover({
            html: true,
            container: "#advice-btn",
            title: "意见反馈",
            content: "<div><label>电话：</label><span>010-58812534</span></div>"+
            "<div><label>邮箱：</label><span>data@cnic.cn</span></div>"+
            "<div><label>QQ群：</label><span>474258921</span></div>",
            placement: "left",
            trigger: "focus"
        });

        $("#unread-news-icon").parent().on("click", function(){
            clearTimeout(notice_id);
            window.location.href = "/help";
        });


    });
</script>

<div id="side_bar" class="sbar_0">
    <ul class="sbar_ul">

        <!-- <li class="sbar_tab">
            <a href="/userview"> <span class="glyphicon glyphicon-user"></span><br />
                <span>我的</span>
            </a>
        </li> -->

        <li class="sbar_tab">
            <a href="javascript:void(0)">
				<span style="display: block;width:25px;height:25px;margin: auto;">
					<img id="unread-news-icon" src="/static/img/index/news_gaogong.png" width="25px">
				</span>
                <span>通知</span>
            </a>
        </li>

        <li class="sbar_tab" id="qrcode-btn">
            <a href="javascript:void(0)"> <span class="glyphicon glyphicon-qrcode"></span><br />
                <span>关注</span>
            </a>
        </li>

        <li class="sbar_tab" id="advice-btn" aria-describedby="popover10396">
            <a href="javascript:void(0)"> <span class="glyphicon glyphicon-earphone"></span><br />
                <span>吐槽</span>
            </a>
        </li>

    </ul>
</div>




<div id="foot_container" class="foot_container">
    <div class="footer-body">
        <div class="container-fluid footer-bottom">
            <div class="row ">
                <div class="col-xs-5 footer-copyright">
                    <div>
                        <spa>面向感知中国的新一代信息技术研究</spa> <span>海云创新实验环境-示范平台</span>
                    </div>
                    <div>
                        <span>版权所有：中国科学院计算机网络信息中心</span> <span>备案序号：京ICP备09112257-61</span>
                    </div>
                </div>
                <div class="col-xs-7 footer-addr">
                    <span>电话：010-58812534&nbsp;&nbsp;&nbsp;&nbsp;邮箱：data@cnic.cn</span>
                    <!-- <img src="http://dcs.conac.cn/image/blue_error.png" style="height: 50px; margin-top: -16px; margin-right: -15px;"> -->
                    <style>#imgConac {height: 50px; margin-top: -16px; margin-right: -15px;}</style>
                    <script type="text/javascript">document.write(unescape("%3Cspan id='_ideConac' %3E%3C/span%3E%3Cscript src='http://dcs.conac.cn/js/33/000/0000/60451603/CA330000000604516030027.js' type='text/javascript'%3E%3C/script%3E"));</script>
                </div>
            </div>
        </div>
    </div>
</div>





<script type="text/javascript" src="/static/js/constants.js"></script>
<script type="text/javascript" src="/static/js/dialogs.js"></script>

<script>
    $(function(){
        var browser_name = null;
        var browser_version = null;
        switch ($.browser.name) {
            case "Internet Explorer":
                switch ($.browser.version) {
                    case 6:
                        browser_name = "Internet Explorer";
                        browser_version = "6";
                        break;
                    case 7:
                        browser_name = "Internet Explorer";
                        browser_version = "7";
                        break;
                    case 8:
                        browser_name = "Internet Explorer";
                        browser_version = "8";
                        break;
                    case 9:
                        browser_name = "Internet Explorer";
                        browser_version = "9";
                        break;
                }
                break;

            case "Tencent Traveler":
                browser_name = "搜狗浏览器";
                browser_version = $.browser.version;
                break;

            case "360SE":
                browser_name = "360浏览器";
                browser_version = $.browser.version;
                break;
        }

        if(browser_name != null && browser_version !=null ){
            dialogs.confirm("检测到您的浏览器为 "+browser_name+" "+browser_version+" ,目前本网站的部分页面的样式与该浏览器不兼容，建议您使用Chrome或FireFox浏览器。");
        }

    });
</script>


<script type="text/javascript">

    $(function(){

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    var csrftoken = $.cookie('csrftoken');
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });
    });


    function adjustFoot(){

        function getViewportInfo(){
            var w = mmV("Width");
            var h = mmV("Height");
            return {w:w,h:h};
        };

        function mmV(c){
            var v =[
                window["inner"+ c],
                document.documentElement["client"+c],
// document.documentElement["scroll"+c],
// document.body["scroll"+c],
// document.body["offset"+c],
// document.documentElement["offset"+c]
            ];

//		if ($.browser.msie ){
//			if(parseInt($.browser.version)){
//				v.push( document.documentElement["offset"+c] );
//			}
//		}

            var r = 0;
            for(var i =0; i < v.length; i++){
                if(v[i] > r) {
                    r = v[i];
                }
            }
            return r;
        }


        if($("#foot_container").length > 0){
            var vinfo = null;
            try{
                vinfo = getViewportInfo();
            }catch (e) {
                return;
            }
            var docH = $(document).height();

            if(vinfo.h == docH){
                $("#foot_container").css({"position": "fixed"});
                $("#foot_container_warp").show();
            }else{
                $("#foot_container").css({"position": "relative"});
                $("#foot_container_warp").hide();
            }
        }
    }

    $(function(){
        if($("#foot_container").length > 0){
            $(document.body).append('<div id="foot_container_warp" style="width: 100%;display: none"></div>');
            $("#foot_container_warp").height($("#foot_container").height());

            $(window).resize(function(e){
                adjustFoot();
            });
        }
        adjustFoot();
        window.setTimeout(function(){
            adjustFoot();
        }, 100);
    });


</script>


<script type="text/javascript">

    $(function(){
        //注册按钮
        $("#sign-up-btn").on("click", function(){
            window.location.href="/accounts/login?page=signup";
        });

        //登录按钮
        $("#sign-in-btn").on("click", function(){
            window.location.href="/accounts/login";
        });

    });

    //科技网 用户登录
    var esc_login = function() {
        window.location = "https://passport.escience.cn/oauth2/authorize?" + $.param({
                "client_id" : "97792",
                "redirect_uri" : "http://www.gscloud.cn/escienceCallback.shtml",
                "response_type" : "code",
                "theme" : "full"
            });
    };

    //微博用户登录
    var wb_login = function(){
        window.location = "https://api.weibo.com/oauth2/authorize?" + $.param({
                "client_id" : "1170886821",
                "redirect_uri" : "http://www.gscloud.cn/weibo_auth_callback",
                "response_type" : "code",
            });
    };

    //QQ用户登录
    var qq_login = function(){
        //window.location = "http://openapi.qzone.qq.com/oauth/show?" + $.param({
        window.location = "https://graph.qq.com/oauth2.0/authorize?" + $.param({
                "client_id" : "101272588",
                "redirect_uri" : "http://www.gscloud.cn/qq_auth_callback",
                "response_type" : "code",
                "which" : "ConfirmPage",
                "display" : "pc"
            });
    };



    var show_error = function( code ) {
        var msg = "";
        if (code == -1){
            msg = "你输入的帐号不存在！";
        }else if (code == -2){
            msg = "你输入的密码错误！";
        }else if (code == -3){
            msg = "你的账号未激活！ <a onclick='resend_activate_email()' href='javascript:void(0)'>发送激活链接</a>";
        }else if (code == -4){
            msg = "用户验证服务失败，请联系管理员！" ;
        }
        $("#error_msg").html(msg).show();
        setTimeout(function(){
            $("#error_msg").fadeOut();
        },3000);
    };
</script>


<script type="text/javascript">

    var sign_up_form = null;
    var sign_in_form = null;

    $(function(){
        /*$.validator.setDefaults({
         debug: true,
         success: "valid"
         });*/

        $('#register-form,#login-form').submit(function(){
            return false;
        });

        $.validator.setDefaults({
            submitHandler : function(form) {
                if($('#register-form').is(":visible")){
                    sign_up();
                }

                if($('#login-form').is(":visible")){
                    loc_login();
                }
            }
        });

        sign_in_form = $("#login-form").validate({

            errorElement : 'span',
            errorClass : 'help-block',
            focusInvalid : false,

            rules: {
                userid: {
                    required: true,
                    email: true
                },

                password: {
                    required: true
                }
            },

            messages : {
                userid: {
                    required : "请输入邮箱",
                    email: "请输入正确的邮箱地址"
                },
                password: {
                    required : "请输入密码"
                }
            },

            highlight : function(element) {
                $(element).closest('.form-group').addClass('has-error');
                $(element).closest('.form-group').find('.validation-icon').addClass('hidden');
            },

            success : function(label) {
                label.closest('.form-group').removeClass('has-error');
                label.closest('.form-group').find('.validation-icon').removeClass('hidden');
                label.remove();
            },

            errorPlacement : function(error, element) {
                element.parent('div').append(error);
            }

        });

        sign_up_form = $("#register-form").validate({

            errorElement : 'span',
            errorClass : 'help-block',
            focusInvalid : false,

            rules: {
                reg_username: {
                    required: true,
                    maxlength: 128
                },

                reg_email: {
                    required : true,
                    email: true,
                    remote:{
                        type:"POST",
                        url:"/accounts/email_chk",
                        data:{
                            email: function(){
                                return $("#reg_email").val();
                            }
                        }
                    }
                },

                reg_password: {
                    required: true,
                    minlength: 6
                }
            },

            messages : {
                reg_username: {
                    required : "请输入用户名",
                    maxlength : $.validator.format("用户名不能大于{0}个字符")
                },
                reg_email: {
                    required : "请输入邮箱地址",
                    email : "请输入正确的邮箱地址",
                    remote : "该邮箱已被注册"
                },
                reg_password: {
                    required : "请输入密码",
                    minlength : $.validator.format("密码不能小于{0}个字符")
                },
            },

            highlight : function(element) {
                $(element).closest('.form-group').addClass('has-error');
                $(element).closest('.form-group').find('.validation-icon').addClass('hidden');
            },

            success : function(label) {
                label.closest('.form-group').removeClass('has-error');
                label.closest('.form-group').find('.validation-icon').removeClass('hidden');
                label.remove();
            },

            errorPlacement : function(error, element) {
                element.parent('div').append(error);
            }

        });
    });

    var loc_login = function() {
        dialogs.wait_mask("正在登录，请稍后...");
        var options = {
            url : "/accounts/validate",
            dataType: "JSON",
            type: "POST",
            success : function(data, statusText) {
                dialogs.hide_wait_mask();
                var code = data["code"];
                if (code == 0){
                    var next= "";
                    if (next == "") next = "/";
                    window.location = next;
                }else if(code == -5){
                    var link = data["msg"];
                    window.location.href=link;
                }else{
                    show_error(code);
                }
            },
            error : function( ) {
                dialogs.hide_wait_mask();
                dialogs.error("系统登录服务调用失败！");
            }
        };

        $('#login-form').ajaxSubmit(options);
        return false;
    };

    var sign_up = function() {
        var options = {
            url : "/accounts/sign_up",
            success : function(email, status) {
                dialogs.hide_wait_mask();
                var info_msg = "<p style='font-size: 18px;text-align: center;margin-top: 8px;'>" +
                    "恭喜您注册成功，请于72小时内登陆<a href='javascript:void(0)'>"+email+"</a>激活！</p>";

                if(status == "success"){
                    $.colorbox({
                        html: info_msg,
                        top: 150,
                        width: 600,
                        height: 100,
                        opacity: 0.3,
                        title: "已激活？去登录",
                        scrolling: false,
                        overlayClose: false
                    });

                    $("#cboxClose").remove();

                    $("#cboxTitle").css("cursor", "pointer").on("click", function(){
                        window.location.href = "/accounts/login";
                    });
                }
            },
            error : function() {
                dialogs.hide_wait_mask();
                dialogs.error("注册失败！");
            }
        };
        dialogs.wait_mask("请稍后！");
        $('#register-form').ajaxSubmit(options);
        return false;
    };

    var resend_activate_email = function(){
        var userid = $("#userid").val();
        if(userid.length == 0){
            return;
        }
        dialogs.wait_mask("请稍后！");
        $.ajax({
            url: "/accounts/resend_activate_email",
            data: {
                "userid": userid
            },
            success: function(email, status){
                dialogs.hide_wait_mask();
                var info_msg = "<p style='font-size: 18px;text-align: center;margin-top: 8px;'>" +
                    "激活链接发送成功，请于72小时内登陆<a href='javascript:void(0)'>"+email+"</a>激活！</p>";

                if(status == "success"){
                    $.colorbox({
                        html: info_msg,
                        top: 150,
                        width: 600,
                        height: 100,
                        opacity: 0.3,
                        scrolling: false,
                        overlayClose: false
                    });
                }
            },
            error: function(){
                dialogs.hide_wait_mask();
                dialogs.error("激活链接发送失败！");
            }
        });
    };


</script>




</body>
</html>
